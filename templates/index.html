<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Split</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen py-8">
  <div class="max-w-2xl mx-auto px-4">
    
    <div class="bg-white rounded-lg shadow-sm border p-6">
      <h1 class="text-2xl font-bold text-gray-900 mb-6">Splitter Music</h1>
      
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="mb-4">
            {% for msg in messages %}
              <div class="text-red-600 bg-red-50 border border-red-200 rounded px-3 py-2 mb-2">{{ msg }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}
      
      <form action="/remove" method="post" enctype="multipart/form-data" class="mb-6" id="uploadForm">
        <div class="mb-4">
          <input type="file" name="file" accept=".mp3,.wav" required 
                 class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-medium file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200">
        </div>
        <button type="submit" class="bg-gray-900 text-white px-6 py-2 rounded hover:bg-gray-800 transition-colors">
          Process
        </button>
      </form>
      
      <!-- Loading State -->
      <div id="loadingState" class="hidden mb-6 p-4 bg-blue-50 border border-blue-200 rounded">
        <div class="flex items-center space-x-3">
          <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div>
          <div>
            <p class="font-medium text-blue-800" id="loadingText">Uploading file...</p>
            <p class="text-sm text-blue-600" id="loadingDetail">Please wait while we process your audio</p>
          </div>
        </div>
      </div>
      
      {% if has_result %}
        <div class="border-t pt-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">Hasil untuk: {{ song }}</h2>
          
          <div class="mb-4">
            <p class="font-medium text-gray-700 mb-2">Vocals:</p>
            <a href="{{ vocals }}" class="inline-block bg-gray-100 text-gray-900 px-4 py-2 rounded hover:bg-gray-200 transition-colors">
              Download
            </a>
            <p class="font-medium text-gray-700 mb-3">Instrumental:</p>
            <a href="{{ instrumental }}" class="inline-block bg-gray-100 text-gray-900 px-4 py-2 rounded hover:bg-gray-200 transition-colors">Download</a>
          </div>
          
          {% if instrumental %}
            <div>
                <p class="font-medium text-gray-700 mb-3">Additional:</p>
              <div class="space-y-2">
                <div class="flex justify-between items-center py-2 px-3 bg-gray-50 rounded">
                  <span class="text-gray-700">Bass</span>
                  <a href="{{ bass }}" class="text-gray-900 hover:text-gray-600 font-medium">Download</a>
                </div>
                <div class="flex justify-between items-center py-2 px-3 bg-gray-50 rounded">
                  <span class="text-gray-700">Drums</span>
                  <a href="{{ drums }}" class="text-gray-900 hover:text-gray-600 font-medium">Download</a>
                </div>
                <div class="flex justify-between items-center py-2 px-3 bg-gray-50 rounded">
                  <span class="text-gray-700">Other</span>
                  <a href="{{ other }}" class="text-gray-900 hover:text-gray-600 font-medium">Download</a>
                </div>
              </div>
            </div>
          {% endif %}
        </div>
      {% endif %}
      
    </div>
  </div>

  <script>
    const uploadForm = document.getElementById('uploadForm');
    const loadingState = document.getElementById('loadingState');
    const loadingText = document.getElementById('loadingText');
    const loadingDetail = document.getElementById('loadingDetail');
    const submitButton = uploadForm.querySelector('button[type="submit"]');

    uploadForm.addEventListener('submit', function(e) {
      // Show loading state
      loadingState.classList.remove('hidden');
      
      // Disable submit button
      submitButton.disabled = true;
      submitButton.textContent = 'Processing...';
      submitButton.classList.add('opacity-50', 'cursor-not-allowed');
      
      // Simulate different processing stages
      setTimeout(() => {
        loadingText.textContent = 'Analyzing audio file...';
        loadingDetail.textContent = 'HTDemucs is separating audio tracks';
      }, 1000);
      
      setTimeout(() => {
        loadingText.textContent = 'Separating vocals...';
        loadingDetail.textContent = 'This may take several minutes for large files';
      }, 3000);
      
      setTimeout(() => {
        loadingText.textContent = 'Processing instrumental tracks...';
        loadingDetail.textContent = 'Generating bass, drums, and other components';
      }, 8000);
      
      setTimeout(() => {
        loadingText.textContent = 'Finalizing results...';
        loadingDetail.textContent = 'Almost done, preparing downloads';
      }, 15000);

      setTimeout(() => {
        loadingText.textContent = 'Make the dessert for you...';
        loadingDetail.textContent = 'preparing downloads in 5 seconds';
      }, 23000);
    });
  </script>
</body>
</html>